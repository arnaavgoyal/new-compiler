#ifndef NK
#define NK(x, num_concrete, children)
#endif

#ifndef DECL
#define DECL(x, num_concrete, children) NK(x, num_concrete, children)
#endif

#ifndef ACCESSOR
#define ACCESSOR(nodekind, accessor_name, child_index)
#endif

#ifndef VARIADIC_ACCESSOR
#define VARIADIC_ACCESSOR(nodekind, accessor_name, start_index)
#endif

DECL(bind, 2,
    ACCESSOR(bind, type_annot, 0)
    ACCESSOR(bind, def, 1)
)

NK(composite, 3,
    ACCESSOR(composite, tmpname, 0)
    ACCESSOR(composite, layout, 1)
    ACCESSOR(composite, namespc, 2)
)

NK(struct_, 0,
    VARIADIC_ACCESSOR(struct_, field, 0)
)

// name is in the ident
DECL(field, 1,
    ACCESSOR(field, type_annot, 0)
)

NK(union_, 0,
    VARIADIC_ACCESSOR(union_, variant, 1)
)

// name is in the ident
DECL(variant, 1,
    ACCESSOR(variant, payload, 0)
)

NK(prog, 0,)
NK(error, 0,) // is this still needed?
NK(null, 0,)

NK(func, 4,
    ACCESSOR(func, captures, 0)
    ACCESSOR(func, params, 1)
    ACCESSOR(func, return_ty, 2)
    ACCESSOR(func, body, 3)
)

NK(captures, 0,
    VARIADIC_ACCESSOR(captures, capture, 0)
)

NK(params, 0,
    VARIADIC_ACCESSOR(params, param, 0)
)

// name is in the ident
DECL(param, 1,
    ACCESSOR(param, type_annot, 0)
)

NK(int_lit, 0,)
NK(char_lit, 0,)
NK(str_lit, 0,)

NK(loop, 2,
    ACCESSOR(loop, cond, 0)
    ACCESSOR(loop, body, 1)
)

// (cond, then_block, optional else_block)
NK(branch, 3,
    ACCESSOR(branch, cond, 0)
    ACCESSOR(branch, then, 1)
    ACCESSOR(branch, else_, 2)
)

NK(block, 0,
    VARIADIC_ACCESSOR(block, stmt, 0)
)

// name is in the ident
NK(ref, 0,)

// Internal reference - no identifier, type pointer is set directly
// Used after meta instantiation to reference concrete types
NK(internalref, 0,)

// called function + comma expr
NK(call, 2,
    ACCESSOR(call, callable, 0)
    ACCESSOR(call, args, 1)
)

NK(paren_expr, 1,
    ACCESSOR(paren_expr, inner, 0)
)

NK(comma_expr, 0,
    VARIADIC_ACCESSOR(comma_expr, expr, 0)
)

NK(subscript, 2,
    ACCESSOR(subscript, array, 0)
    ACCESSOR(subscript, index, 1)
)

NK(cast, 2,
    ACCESSOR(cast, expr, 0)
    ACCESSOR(cast, type, 1)
)

NK(unary_op, 1,
    ACCESSOR(unary_op, operand, 0)
)

NK(binary_op, 2,
    ACCESSOR(binary_op, lhs, 0)
    ACCESSOR(binary_op, rhs, 1)
)

#undef VARIADIC_ACCESSOR
#undef ACCESSOR
#undef TYPE_EXPR
#undef DECL
#undef NK
